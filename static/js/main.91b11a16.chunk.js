(this.webpackJsonpf2e_chal_3=this.webpackJsonpf2e_chal_3||[]).push([[0],{139:function(t,e,n){},251:function(t,e,n){},252:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n.n(a),o=n(33),r=n.n(o),i=(n(139),n(16)),u=n(128),l=n(132),s=n(7);var p=function(t){var e=Object(i.g)();return Object(s.jsxs)("div",{children:[Object(s.jsx)(l.a,{onClick:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){var n=t.coords,a=n.latitude,c=n.longitude;e.push({pathname:"/nearby-stations",search:"lat=".concat(a,"&long=").concat(c)})})):console.error("Geolocation is not supported by this browser.")},children:"\u9644\u8fd1\u516c\u8eca\u7ad9"}),Object(s.jsx)(l.a,{onClick:function(){return e.push("/search-bus")},children:"\u67e5\u8a62\u516c\u8eca"})]})},b=n(54),d=n.n(b),f=n(50);function j(t){var e=Object(a.useState)(),n=Object(f.a)(e,2),c=n[0],o=n[1],r=Object(a.useState)(t),i=Object(f.a)(r,2),u=i[0],l=i[1],s=Object(a.useCallback)((function(t){var e=t.api,n=t.onSuccess,a=void 0===n?function(){}:n,c=t.mapper,r=void 0===c?function(t){return t.data}:c;o(!0),e.then((function(t){var e=r?r(t):t;o(!1),l(e),a(e)})).catch((function(t){o(!1),console.error(t)}))}),[]);return{apiAdapter:s,data:u,isLoading:c}}var h=n(30),v=n.n(h),O=n(256),g=n(257),m=n(124),C={0:"\u6b63\u5e38",1:"\u5c1a\u672a\u767c\u8eca",2:"\u4ea4\u7ba1\u4e0d\u505c\u9760",3:"\u672b\u73ed\u8eca\u5df2\u904e",4:"\u4eca\u65e5\u672a\u71df\u904b"};var x=function(t){var e=j([]),n=e.apiAdapter,c=e.isLoading,o=e.data,r=j(["",""]),u=r.apiAdapter,l=(r.isLoading,r.data),p=Object(i.g)(),b=d.a.parse(p.location.search),f=b.city,h=b.route,x=O.a.TabPane,y=g.a.Step;return Object(a.useEffect)((function(){n({api:v.a.get("https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/".concat(f,"/").concat(encodeURIComponent(h))),mapper:function(t){return t.data.map((function(t){return t.Stops}))},onSuccess:function(t){2!==t.length&&console.error("\u516c\u8eca\u8def\u7dda\u8cc7\u8a0a\u4e0d\u5982\u9810\u671f")}})}),[n,f,h]),Object(a.useEffect)((function(){u({api:v.a.get("https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/".concat(f,"/").concat(encodeURIComponent(h))),mapper:function(t){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];console.log("estimated info",t);var e=[],n=[];t.forEach((function(t){0===t.Direction?e.push(t):1===t.Direction?n.push(t):console.error("\u516c\u8eca\u8cc7\u8a0a\u7684Direction\u4e0d\u5982\u9810\u671f",t,t.Direction)}));var a=function(t,e){if(0===t){var n=Math.ceil(e/60);return n?"".concat(n,"\u5206\u9418"):"\u5373\u5c07\u9032\u7ad9"}return C[t]},c=function(t){return t.reduce((function(t,e){var n=e.StopName,c=e.StopStatus,o=e.EstimateTime;return t[n.Zh_tw]?t[n.Zh_tw].push(a(c,o)):t[n.Zh_tw]=[a(c,o)],t}),{})};return console.log("\u516c\u8eca\u9032\u7ad9\u8cc7\u8a0a",[c(e),c(n)]),[c(e),c(n)]}(t.data)}})}),[u,f,h]),Object(s.jsx)(m.a,{spinning:c,children:Object(s.jsx)(O.a,{children:o.slice(0,2).map((function(t,e){return Object(s.jsx)(x,{tab:"\u5f80 ".concat(t[t.length-1].StopName.Zh_tw),children:Object(s.jsx)(g.a,{direction:"vertical",children:t.map((function(t,n){return Object(s.jsx)(y,{title:t.StopName.Zh_tw,description:l[e][t.StopName.Zh_tw]&&l[e][t.StopName.Zh_tw][0]},n)}))})},e)}))})})},y=n(258),S=n(255),w=n(41),T=n(85),N=["flex","row","justify","aligm","style","wrap","gap"],I=function(t){var e=t.flex,n=t.row,a=t.justify,c=t.aligm,o=t.style,r=t.wrap,i=t.gap,u=Object(T.a)(t,N);return Object(s.jsx)("div",Object(w.a)({style:Object(w.a)({display:"flex",flexGrow:e?1:0,justifyContent:a,alignItems:c,gap:i,flexDirection:n?"row":"column",flexWrap:r?"wrap":"nowrap"},o)},u))},H=["span"],Z=function(t){var e=t.span,n=void 0===e?"100":e,a=Object(T.a)(t,H);return Object(s.jsx)(I,Object(w.a)(Object(w.a)({},a),{},{style:{flex:"0 0 ".concat(n,"%"),maxWidth:"".concat(n,"%")}}))},E=function(t){return Object(s.jsx)(I,Object(w.a)(Object(w.a)({wrap:!0},t),{},{style:{width:"100%"}}))},_=[{label:"\u81fa\u5317\u5e02",code:"TPE",value:"Taipei"},{label:"\u65b0\u5317\u5e02",code:"NTPC",value:"NewTaipei"},{label:"\u6843\u5712\u5e02",code:"TYN",value:"Taoyuan"},{label:"\u81fa\u4e2d\u5e02",code:"TXG",value:"Taichung"},{label:"\u81fa\u5357\u5e02",code:"TNN",value:"Tainan"},{label:"\u9ad8\u96c4\u5e02",code:"KHH",value:"Kaohsiung"},{label:"\u57fa\u9686\u5e02",code:"KEL",value:"Keelung"},{label:"\u65b0\u7af9\u5e02",code:"HSZ",value:"Hsinchu"},{label:"\u65b0\u7af9\u7e23",code:"HSZ",value:"HsinchuCounty"},{label:"\u82d7\u6817\u7e23",code:"ZMI",value:"MiaoliCounty"},{label:"\u5f70\u5316\u7e23",code:"CHW",value:"ChanghuaCounty"},{label:"\u5357\u6295\u7e23",code:"NTC",value:"NantouCounty"},{label:"\u96f2\u6797\u7e23",code:"YUN",value:"YunlinCounty"},{label:"\u5609\u7fa9\u7e23",code:"CYI",value:"ChiayiCounty"},{label:"\u5609\u7fa9\u5e02",code:"CYI",value:"Chiayi"},{label:"\u5c4f\u6771\u7e23",code:"PIF",value:"PingtungCounty"},{label:"\u5b9c\u862d\u7e23",code:"ILA",value:"YilanCounty"},{label:"\u82b1\u84ee\u7e23",code:"HUN",value:"HualienCounty"},{label:"\u81fa\u6771\u7e23",code:"TTT",value:"TaitungCounty"},{label:"\u91d1\u9580\u7e23",code:"KNH",value:"KinmenCounty"},{label:"\u6f8e\u6e56\u7e23",code:"PEH",value:"PenghuCounty"},{label:"\u9023\u6c5f\u7e23",code:"LNN",value:"LienchiangCounty"}];var A=function(t){return Object(s.jsx)(S.b,Object(w.a)({bordered:!0,renderItem:function(t){var e=t.onClick,n=void 0===e?function(){}:e,a=t.title,c=t.desc;return Object(s.jsx)(S.b.Item,{children:Object(s.jsxs)(I,{onClick:n,children:[a,Object(s.jsx)(I,{children:c})]})})}},t))};var L=function(t){var e=Object(i.g)(),n=Object(a.useState)(""),c=Object(f.a)(n,2),o=c[0],r=c[1],u=Object(a.useState)(_[0]),p=Object(f.a)(u,2),b=p[0],d=p[1],h=Object(a.useState)(!1),O=Object(f.a)(h,2),g=O[0],C=O[1],x=Object(a.useCallback)((function(t){return r(o.concat(t))}),[o,r]),w=[{event:function(){return C(!0)},span:60,label:b.label},{event:function(){return x("")},span:40,label:"\u624b\u52d5\u8f38\u5165"},{event:function(){return x("\u7d05")},span:20,label:"\u7d05"},{event:function(){return x("\u85cd")},span:20,label:"\u7c43"},{event:function(){return x("1")},span:20,label:"1"},{event:function(){return x("2")},span:20,label:"2"},{event:function(){return x("3")},span:20,label:"3"},{event:function(){return x("\u7da0")},span:20,label:"\u7da0"},{event:function(){return x("\u68d5")},span:20,label:"\u68d5"},{event:function(){return x("4")},span:20,label:"4"},{event:function(){return x("5")},span:20,label:"5"},{event:function(){return x("6")},span:20,label:"6"},{event:function(){return x("\u6a58")},span:20,label:"\u6a58"},{event:function(){return x("\u5c0f")},span:20,label:"\u5c0f"},{event:function(){return x("7")},span:20,label:"7"},{event:function(){return x("8")},span:20,label:"8"},{event:function(){return x("9")},span:20,label:"9"},{event:function(){return x("\u5e79\u7dda")},span:20,label:"\u5e79\u7dda"},{event:function(){return x("more")},span:20,label:"\u66f4\u591a"},{event:function(){return x(0)},span:20,label:"C"},{event:function(){return x("0")},span:20,label:"0"},{event:function(){return r(o.slice(0,-1))},span:20,label:"Clear"}],T=j([]),N=T.apiAdapter,H=T.isLoading,L=T.data;return Object(a.useEffect)((function(){N({api:v.a.get("https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(b.value,"/").concat(encodeURIComponent(o))),mapper:function(t){return t.data.map((function(t){var n=t.DepartureStopNameZh,a=t.DestinationStopNameZh,c=t.RouteName.Zh_tw;return{title:c,desc:"".concat(n," \u5f80 ").concat(a),onClick:function(){return e.push({pathname:"/bus-stop-info",search:"city=".concat(b.value,"&route=").concat(c)})}}}))}})}),[o,b.value,N,e]),Object(s.jsxs)(I,{row:!0,children:[Object(s.jsxs)(I,{children:[Object(s.jsxs)(I,{row:!0,children:["Icon",Object(s.jsx)(y.a,{value:o,onChange:function(t){return r(t.target.value)}})]}),Object(s.jsx)(E,{row:!0,children:g?_.map((function(t){var e=t.value,n=t.label;return Object(s.jsx)(Z,{span:20,children:Object(s.jsx)(l.a,{onClick:function(){d({value:e,label:n}),C(!1)},children:n})},e)})):w.map((function(t,e){var n=t.span,a=t.label,c=t.event;return Object(s.jsx)(Z,{span:n,children:Object(s.jsx)(l.a,{onClick:c,children:a})},e)}))})]}),Object(s.jsx)(I,{children:Object(s.jsxs)(m.a,{spinning:H,children:[b.label,Object(s.jsx)(A,{dataSource:L}),Object(s.jsx)(S.b,{bordered:!0,dataSource:L})]})})]})};var M=function(t){var e=Object(i.g)(),n=j(),c=n.apiAdapter,o=(n.isLoading,j()),r=o.apiAdapter,u=(o.isLoading,d.a.parse(e.location.search)),l=u.lat,p=u.long,b=Object(a.useMemo)((function(){return[]}),[]);return Object(a.useEffect)((function(){c({api:v.a.get("https://ptx.transportdata.tw/MOTC/v2/Bus/Station/NearBy?$spatialFilter=nearby(".concat(l,",").concat(p,",500)")),mapper:function(t){return t.data.map((function(t){var e=t.StationName,n=t.StationID,a=t.LocationCityCode;return{title:e.Zh_tw,stationId:n,cityCode:a}}))},onSuccess:function(t){t.forEach((function(t){var n=t.title,a=t.stationId,c=t.cityCode,o=_.find((function(t){return t.code===c})).value;r({api:v.a.get("https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(o,"/PassThrough/Station/").concat(a)),onSuccess:function(t){console.log("data",t),b.push({title:n,desc:t.map((function(t){return t.RouteName.Zh_tw})).join(", "),onClick:function(){return e.push({pathname:"/station-bus-list",search:"city=".concat(o,"&stationId=").concat(a)})}})}})}))}})}),[c,l,p,b,r,e]),Object(s.jsx)(A,{dataSource:b})};var k=function(t){var e=Object(i.g)(),n=j(),c=n.apiAdapter,o=(n.isLoading,n.data),r=d.a.parse(e.location.search),u=r.city,l=r.stationId;return Object(a.useEffect)((function(){c({api:v.a.get("https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(u,"/PassThrough/Station/").concat(l)),mapper:function(t){return console.log("data",t.data),t.data.map((function(t){var n=t.RouteName.Zh_tw,a=t.DestinationStopNameZh;return{title:n,desc:"\u5f80 ".concat(a),onClick:function(){return e.push({pathname:"/bus-stop-info",search:"city=".concat(u,"&route=").concat(n)})}}}))}})}),[c,u,l,e]),Object(s.jsx)(A,{dataSource:o})},D=n(131);function P(){v.a.interceptors.request.use((function(t){var e=(new Date).toGMTString(),n=new D.a("SHA-1","TEXT");n.setHMACKey("MqcHWHmbsyYHjqeJx8ALvBJHF_I","TEXT"),n.update("x-date: "+e);var a='hmac username="ab90c39442fe4cf5b7e7707057a5dd23", algorithm="hmac-sha1", headers="x-date", signature="'+n.getHMAC("B64")+'"';return t.headers.Authorization=a,t.headers["X-Date"]=e,t}))}n(250),n(251);var B=function(){var t=function(){return Object(s.jsxs)(i.d,{children:[Object(s.jsx)(i.b,{path:"/home",component:p}),Object(s.jsx)(i.b,{path:"/search-bus",component:L}),Object(s.jsx)(i.b,{path:"/bus-stop-info",component:x}),Object(s.jsx)(i.b,{path:"/nearby-stations",component:M}),Object(s.jsx)(i.b,{path:"/station-bus-list",component:k}),Object(s.jsx)(i.a,{to:"/home"})]})};return Object(a.useEffect)((function(){P()}),[]),P(),Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(u.a,{children:Object(s.jsx)(t,{})})})},R=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,259)).then((function(e){var n=e.getCLS,a=e.getFID,c=e.getFCP,o=e.getLCP,r=e.getTTFB;n(t),a(t),c(t),o(t),r(t)}))};r.a.render(Object(s.jsx)(c.a.StrictMode,{children:Object(s.jsx)(B,{})}),document.getElementById("root")),R()}},[[252,1,2]]]);
//# sourceMappingURL=main.91b11a16.chunk.js.map